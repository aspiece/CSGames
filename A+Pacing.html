<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CompTIA A+ Accelerated Pacing Guide</title>
  <style>
    :root{--bg:#0f172a;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;--accent:#22d3ee;--table:#1f2937}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif}
    .wrap{max-width:1400px;margin:40px auto;padding:0 20px}
    h1{font-size:clamp(1.4rem,2.5vw,2rem);margin:0 0 10px}
    p{color:var(--muted);margin:0 0 24px}
    .card{background:var(--card);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.25);overflow:hidden;padding:18px}
    table{width:100%;border-collapse:collapse;font-size:14px}
    thead{background:var(--table)}
    th,td{padding:14px 12px;vertical-align:top}
    th{font-weight:700;text-align:left;letter-spacing:.02em}
    tbody tr{border-bottom:1px solid rgba(255,255,255,.06)}
    tbody tr:hover{background:rgba(34,211,238,.03)}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    .small{font-size:12px;color:var(--muted)}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:rgba(34,211,238,.15);color:#a5f3fc;font-weight:600;font-size:12px;margin-left:6px}
    .sticky{position:sticky;left:0;background:var(--card)}
    @media (max-width:900px){
      table{display:block;overflow:auto;white-space:nowrap}
    }
    ul.agenda{margin:6px 0;padding-left:18px;font-size:13px;line-height:1.4}

    /* Collapsible UI */
    .day-nav{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px;align-items:center}
    .day-btn{background:transparent;border:1px solid rgba(255,255,255,.06);color:var(--text);padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
    .day-btn.active{background:var(--accent);color:#042023;border:none}
    .day-row{display:none}
    .day-row.visible{display:table-row}
    td.day-toggle{cursor:pointer;width:48px;text-align:center;font-weight:700;border-right:1px solid rgba(255,255,255,.03)}
    .hint{color:var(--muted);font-size:13px;margin-bottom:8px}
    .status{color:var(--muted);margin-bottom:12px}
    .permalink {margin-left:12px;padding:6px 10px;border-radius:8px;background:rgba(255,255,255,.04);color:var(--muted);cursor:pointer;font-size:13px}
    .permalink.copied {background:var(--accent);color:#042023}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>CompTIA A+ Pacing Guide</h1>
    <p>Each session follows Merrill’s Effective Instruction (Activation → Demonstration → Application → Integration). All worksheets, videos, and assessments are distributed via Google Classroom. Slides are used to pace class time and display prompts, timers, and brain‑break instructions.</p>

    <div class="card">
      <div class="hint">This page loads its content from pacing.csv in the same directory. Click a date to reveal that day's plan. Each day gets a unique URL (hash).</div>
      <div id="status" class="status">Loading pacing.csv …</div>

      <!-- calendar-style selection: date picker + available-dates grid -->
      <div style="display:flex;flex-wrap:wrap;align-items:center;gap:8px;margin-bottom:12px">
        <label class="small" for="date-picker" style="margin:0">Jump to date:</label>
        <input id="date-picker" type="date" style="padding:6px;border-radius:8px;border:1px solid rgba(255,255,255,.06);background:transparent;color:var(--text)" />
        <button id="today-btn" class="day-btn" type="button" title="Go to today">Today</button>
        <button id="clear-btn" class="day-btn" type="button" title="Collapse all" style="background:transparent">Clear</button>
        <div style="flex:1"></div>
        <button id="copy-permalink" class="permalink" title="Copy permalink for the currently open day" style="display:none">Copy link</button>
      </div>

      <div id="day-nav" class="day-nav" aria-hidden="false" style="gap:6px;max-width:100%;overflow:auto;padding-bottom:6px"></div>

      <table id="pacing-table" role="table" aria-label="pacing guide">
        <thead>
          <tr>
            <th class="sticky">Day</th>
            <th>Lesson</th>
            <th>Topics</th>
            <th>Agenda (Merrill’s Principles)</th>
            <th>Brain Break (for slides to project)</th>
            <th>Summative</th>
            <th>During class</th>
            <th>Teacher Prep (Before class)</th>
          </tr>
        </thead>
        <tbody id="pacing-body">
          <!-- Rows rendered from pacing.csv -->
        </tbody>
      </table>
    </div>

    <p class="small" style="margin-top:24px;">Guide by <b>aspiece</b>. For feedback or updates, contact the author.</p>
  </div>

  <script>
    // CSV parser (handles quoted fields and newlines)
    function parseCSV(text) {
      const rows = [];
      let cur = '';
      let row = [];
      let inQuotes = false;
      for (let i = 0; i < text.length; i++) {
        const ch = text[i];
        const next = text[i+1];
        if (ch === '"') {
          if (inQuotes && next === '"') { cur += '"'; i++; } // escaped quote
          else inQuotes = !inQuotes;
          continue;
        }
        if (ch === ',' && !inQuotes) {
          row.push(cur); cur = ''; continue;
        }
        if ((ch === '\n' || ch === '\r') && !inQuotes) {
          if (ch === '\r' && next === '\n') { /* skip paired */ }
          if (cur !== '' || row.length) { row.push(cur); cur = ''; rows.push(row); row = []; }
          continue;
        }
        cur += ch;
      }
      if (cur !== '' || row.length) { row.push(cur); rows.push(row); }
      return rows;
    }

    function csvToObjects(text) {
      const rows = parseCSV(text).filter(r => r.length > 0);
      if (rows.length < 1) return [];
      const headers = rows[0].map(h => h.trim());
      return rows.slice(1).map(r => {
        const obj = {};
        headers.forEach((h, i) => obj[h] = (r[i] || '').trim());
        return obj;
      });
    }

    // Parse various date formats and normalize to ISO (yyyy-mm-dd).
    function parseDateString(s) {
      if (!s) return null;
      s = s.trim();
      // If already ISO-like yyyy-mm-dd
      if (/^\d{4}-\d{2}-\d{2}$/.test(s)) return s;
      // Try common US format mm/dd/yyyy or m/d/yyyy
      const m = s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{2,4})$/);
      if (m) {
        let mm = m[1].padStart(2,'0'), dd = m[2].padStart(2,'0'), yy = m[3];
        if (yy.length === 2) yy = '20' + yy;
        return `${yy}-${mm}-${dd}`;
      }
      // Try Date.parse fallback (may accept formats like "Aug 29 2025")
      const d = new Date(s);
      if (!isNaN(d.getTime())) {
        const y = d.getFullYear();
        const mm = String(d.getMonth()+1).padStart(2,'0');
        const dd = String(d.getDate()).padStart(2,'0');
        return `${y}-${mm}-${dd}`;
      }
      return null;
    }

    function formatDisplayDate(iso) {
      if (!iso) return '';
      const d = new Date(iso);
      if (isNaN(d.getTime())) return iso;
      const opts = {month:'short', day:'numeric'};
      return d.toLocaleDateString(undefined, opts);
    }

    // Render rows dynamically from CSV. Accepts arbitrary number of days.
    function renderRows(data) {
      const tbody = document.getElementById('pacing-body');
      tbody.innerHTML = '';
      // normalize and enrich items with isoDate
      data.forEach(item => {
        const iso = parseDateString(item.Day) || '';
        const tr = document.createElement('tr');
        tr.className = 'day-row';
        tr.setAttribute('data-day', item.Day || '');
        tr.setAttribute('data-date', iso); // normalized ISO date for routing
        // Agenda and other rich fields may contain HTML from CSV
        tr.innerHTML = `
          <td class="sticky day-toggle">${escapeHtml(item.Day || iso || '')}</td>
          <td>${escapeHtml(item.Lesson || '')}</td>
          <td>${escapeHtml(item.Topics || '')}</td>
          <td>${item.Agenda || ''}</td>
          <td>${item.BrainBreak || ''}</td>
          <td class="small">${escapeHtml(item.Summative || '—')}</td>
          <td>${item.duringclass || ''}</td>
          <td>${item.TeacherPrep || ''}</td>
        `;
        tbody.appendChild(tr);
      });
      initCollapsibleUI();
    }

    function escapeHtml(s) {
      return String(s)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    // Fetch pacing.csv from same directory and render it
    function fetchPacingCsv() {
      const statusEl = document.getElementById('status');
      return fetch('pacing.csv', {cache: 'no-store'})
        .then(resp => {
          if (!resp.ok) throw new Error('pacing.csv not found (HTTP ' + resp.status + ')');
          return resp.text();
        })
        .then(text => {
          const objs = csvToObjects(text);
          if (!objs.length) throw new Error('pacing.csv is empty or malformed');
          renderRows(objs);
          statusEl.textContent = `Loaded pacing.csv (${objs.length} day${objs.length===1?'':'s'})`;
          setTimeout(() => applyInitialRoute(), 20);
        })
        .catch(err => {
          console.error(err);
          document.getElementById('status').textContent = 'Error loading pacing.csv — see console for details.';
          alert('Could not load pacing.csv from the same directory. Ensure pacing.csv exists and uses headers: Day,Lesson,Topics,Agenda,BrainBreak,Summative,duringclass,TeacherPrep');
        });
    }

    // Open a day by its Day value (exact match), ISO date (yyyy-mm-dd), or numeric index (1-based)
    function openDay(dayValue) {
      const rows = Array.from(document.querySelectorAll('.day-row'));
      if (!rows.length) return;
      let target = null;
      const val = String(dayValue || '');
      // try exact data-date match first (ISO)
      target = rows.find(r => (r.getAttribute('data-date') || '') === val);
      if (!target) {
        // try data-day exact match (original string)
        target = rows.find(r => r.getAttribute('data-day') === val);
      }
      if (!target) {
        // try numeric index
        const idx = parseInt(val, 10);
        if (!Number.isNaN(idx) && idx >= 1 && idx <= rows.length) target = rows[idx-1];
      }
      if (!target) return false;
      rows.forEach(r => r.classList.remove('visible'));
      target.classList.add('visible');
      document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
      const btn = Array.from(document.querySelectorAll('.day-btn')).find(b => b.dataset.date === (target.getAttribute('data-date') || b.dataset.date));
      if (btn) btn.classList.add('active');
      const hash = `day-${encodeURIComponent(target.getAttribute('data-date')||target.getAttribute('data-day')||'')}`;
      if (location.hash !== `#${hash}`) location.hash = hash;
      document.getElementById('copy-permalink').style.display = 'inline-block';
      target.scrollIntoView({behavior: 'smooth', block: 'center'});
      return true;
    }

    // Build navigation and wire up toggles
    function initCollapsibleUI() {
      const rows = Array.from(document.querySelectorAll('.day-row'));
      const dayNav = document.getElementById('day-nav');
      dayNav.innerHTML = '';
      // create a calendar-style pill for each available date
      rows.forEach((row, idx) => {
        const iso = row.getAttribute('data-date') || '';
        const label = iso ? formatDisplayDate(iso) : (row.getAttribute('data-day') || (idx+1).toString());
        const btn = document.createElement('button');
        btn.className = 'day-btn';
        btn.type = 'button';
        btn.textContent = label;
        btn.title = row.getAttribute('data-day') || iso || label;
        btn.dataset.date = iso;
        btn.dataset.day = row.getAttribute('data-day') || '';
        btn.addEventListener('click', () => {
          // prefer iso date when available
          openDay(iso || row.getAttribute('data-day') || (idx+1).toString());
        });
        dayNav.appendChild(btn);
      });

      // populate date-picker min/max and list of available dates
      const picker = document.getElementById('date-picker');
      const dates = rows.map(r => r.getAttribute('data-date')).filter(Boolean).sort();
      if (dates.length) {
        picker.min = dates[0];
        picker.max = dates[dates.length-1];
      } else {
        picker.removeAttribute('min'); picker.removeAttribute('max');
      }

      // wire picker change to open day
      picker.addEventListener('change', (e) => {
        if (e.target.value) openDay(e.target.value);
      });
      // today and clear buttons
      document.getElementById('today-btn').addEventListener('click', () => {
        const todayIso = new Date().toISOString().slice(0,10);
        // if exact match exists open it else try nearest
        if (!openDay(todayIso)) {
          // try to find nearest date >= today, else first available
          const next = dates.find(d => d >= todayIso) || dates[0];
          if (next) openDay(next);
        }
      });
      document.getElementById('clear-btn').addEventListener('click', () => {
        // collapse all and clear hash
        rows.forEach(r => r.classList.remove('visible'));
        document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
        history.replaceState(null, '', location.pathname + location.search);
        document.getElementById('copy-permalink').style.display = 'none';
      });

      document.querySelectorAll('td.day-toggle').forEach(td => {
        td.style.cursor = 'pointer';
        td.addEventListener('click', () => {
          const tr = td.closest('tr');
          // when clicking the left cell prefer data-date then data-day
          const date = tr.getAttribute('data-date') || tr.getAttribute('data-day');
          openDay(date);
         });
       });
     }

    // Hash helpers
    function parseHash() {
      if (!location.hash) return null;
      const h = location.hash.replace(/^#/, '');
      if (h.startsWith('day-')) return decodeURIComponent(h.slice(4));
      return null;
    }

    function applyInitialRoute() {
      const dayFromHash = parseHash();
      if (dayFromHash) {
        const opened = openDay(dayFromHash);
        if (!opened) {
          const num = dayFromHash.match(/\d+/);
          if (num) openDay(num[0]);
        }
      }
    }

    // Permalink copy
    function setupPermalink() {
      const btn = document.getElementById('copy-permalink');
      btn.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(location.href);
          btn.classList.add('copied'); btn.textContent = 'Copied';
          setTimeout(() => { btn.classList.remove('copied'); btn.textContent = 'Copy link'; }, 1500);
        } catch (e) {
          alert('Could not copy link. Please copy manually: ' + location.href);
        }
      });

      window.addEventListener('hashchange', () => {
        const dayFromHash = parseHash();
        if (dayFromHash) openDay(dayFromHash);
      });
    }

    document.addEventListener('DOMContentLoaded', function() {
      setupPermalink();
      fetchPacingCsv();
    });
  </script>
</body>
</html>
