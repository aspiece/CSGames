<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CompTIA A+ Preparation</title>
  <style>
    :root {
      --bg: #0f1115;
      --card: #171a21;
      --text: #e6e8ee;
      --muted: #b9c0d4;
      --accent: #6ea8fe;
    }
    html, body { margin:0; padding:0; background:var(--bg); color:var(--text); font: 14px/1.45 system-ui, Segoe UI, Roboto, Arial, sans-serif; }
    .wrap { max-width: 1100px; margin: 24px auto; padding: 0 16px; }
    h1 { margin: 0 0 6px; font-size: 1.8rem; }
    h2 { margin: 0 0 16px; font-size: 1.05rem; color: var(--muted); }
    .status { margin: 8px 0 16px; color: var(--muted); }

    .layout {
      display: grid;
      grid-template-columns: 240px 1fr;
      gap: 16px;
      align-items: start;
    }

    /* Left nav (dates from CSV only) */
    #day-nav {
      position: sticky;
      top: 12px;
      align-self: start;
      display: flex;
      flex-direction: column;
      gap: 8px;
      height: calc(100dvh - 24px);
      overflow: hidden; /* no scroll in left column per request */
    }
    .day-btn {
      all: unset;
      display: block;
      padding: 8px 10px;
      background: #1a1f28;
      border: 1px solid #262b36;
      border-radius: 8px;
      color: var(--text);
      cursor: pointer;
    }
    .day-btn:hover { background: #212634; }
    .day-btn.active {
      background: #263143;
      border-color: #344155;
      color: #fff;
      box-shadow: 0 0 0 2px rgba(110,168,254,0.12) inset;
    }

    /* Content area */
    #content-area { min-height: 200px; }
    .day-card { display: none; margin: 0 0 14px; }
    .day-card.visible { display: block; }
    .card-inner {
      background: var(--card);
      border: 1px solid #262b36;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 6px 18px rgba(0,0,0,.18);
    }
    .section { margin: 10px 0; }
    .section h3 { margin: 0 0 6px; font-size: 1.05rem; }
    .section .section-content { color: var(--muted); white-space: pre-wrap; }

    .hint-card .hint {
      color: var(--muted);
      font-size: 0.95rem;
      padding: 12px 14px;
      border-radius: 10px;
      background: #12141a;
      border: 1px dashed #2b3342;
    }

    @media (max-width: 860px) {
      .layout { grid-template-columns: 1fr; }
      #day-nav { position: static; height: auto; overflow: visible; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>CompTIA A+ Preparation</h1>
    <h2>Genesee Career Institute</h2>

    <div id="status" class="status">Loading...</div>

    <div class="hint-card">
      <div class="hint">This page loads its content from pacing.csv in the same directory. The left column shows only the dates found in the CSV “Day” column.</div>
    </div>

    <div class="layout" style="margin-top:16px;">
      <nav id="day-nav" aria-label="Lesson dates"></nav>
      <main id="content-area" role="main"></main>
    </div>
  </div>

  <script>
    const CSV_URL = 'pacing.csv';
    let CSV_HEADERS = [];

    document.addEventListener('DOMContentLoaded', () => {
      // Load CSV and render on page load
      loadCsvAndRender();
    });

    const dayCards = Array.from(document.querySelectorAll('.day-card'));
    const validDates = new Set();

    // Extract valid dates from the pacing.csv file
    dayCards.forEach(card => {
      const date = card.getAttribute('data-date');
      if (date) {
        validDates.add(date);
      }
    });

    // Ensure only valid dates are displayed
    dayCards.forEach(card => {
      const date = card.getAttribute('data-date');
      if (!validDates.has(date)) {
        card.style.display = 'none'; // Hide cards for invalid dates
      }
    });

    // Handle navigation buttons
    const dayButtons = Array.from(document.querySelectorAll('.day-btn'));
    dayButtons.forEach(button => {
      const date = button.getAttribute('data-date');
      if (!validDates.has(date)) {
        button.style.display = 'none'; // Hide buttons for invalid dates
      }
    });

    async function loadCsvAndRender() {
      const statusEl = document.getElementById('status');
      try {
        statusEl.textContent = 'Loading pacing.csv...';
        const resp = await fetch(CSV_URL, { cache: 'no-store' });
        if (!resp.ok) throw new Error('HTTP ' + resp.status);
        const text = await resp.text();

        const rows = csvToObjects(text);
        if (!rows.length) {
          statusEl.textContent = 'No days found in pacing.csv.';
          renderEmpty();
          return;
        }
        renderFromCsv(rows);
        statusEl.textContent = `Loaded ${rows.length} day${rows.length === 1 ? '' : 's'} from pacing.csv.`;
        applyInitialRoute();
      } catch (err) {
        console.error('Failed to load CSV:', err);
        document.getElementById('status').textContent = 'Error loading pacing.csv. Ensure the file exists and is reachable.';
        renderEmpty();
      }
    }

    function renderEmpty() {
      document.getElementById('day-nav').innerHTML = '';
      document.getElementById('content-area').innerHTML = '';
    }

    // Parse CSV to array of objects; first row is headers.
    function csvToObjects(text) {
      const rows = parseCSV(text).filter(r => r.length && r.some(c => (c || '').trim() !== ''));
      if (!rows.length) return [];
      const headers = rows[0].map(h => (h || '').trim());

      // Strip UTF-8 BOM from first header if present (common from Excel)
      if (headers.length) headers[0] = headers[0].replace(/^\uFEFF/, '');

      CSV_HEADERS = headers.slice();
      // Minimal required: Day
      if (!headers.includes('Day')) return [];
      const dataRows = rows.slice(1);
      const objects = dataRows.map(r => {
        const obj = {};
        headers.forEach((h, i) => obj[h] = (r[i] || '').trim());
        return obj;
      }).filter(o => (o.Day || '').trim().length > 0);
      return objects;
    }

    // Robust-ish CSV parser for quotes and commas
    function parseCSV(text) {
      const out = [];
      let row = [], cell = '', inQ = false;
      for (let i = 0; i < text.length; i++) {
        const ch = text[i];
        if (inQ) {
          if (ch === '"') {
            if (text[i + 1] === '"') { cell += '"'; i++; }
            else { inQ = false; }
          } else {
            cell += ch;
          }
        } else {
          if (ch === '"') inQ = true;
          else if (ch === ',') { row.push(cell); cell = ''; }
          else if (ch === '\n') { row.push(cell); out.push(row); row = []; cell = ''; }
          else if (ch === '\r') { /* ignore */ }
          else { cell += ch; }
        }
      }
      if (cell.length > 0 || row.length > 0) { row.push(cell); out.push(row); }
      return out;
    }

    // Build UI strictly from CSV rows (no sequential dates)
    function renderFromCsv(rows) {
      const nav = document.getElementById('day-nav');
      const main = document.getElementById('content-area');
      nav.innerHTML = '';
      main.innerHTML = '';

      rows.forEach((item, idx) => {
        const dayLabel = (item.Day || '').trim(); // use exactly what’s in CSV
        if (!dayLabel) return;

        // Nav button (shows the CSV Day string verbatim)
        const btn = document.createElement('button');
        btn.className = 'day-btn';
        btn.type = 'button';
        btn.textContent = dayLabel;
        btn.dataset.key = dayLabel;
        btn.setAttribute('aria-label', `Open ${dayLabel}`);
        btn.addEventListener('click', () => openDay(dayLabel));
        nav.appendChild(btn);

        // Content card
        const card = document.createElement('article');
        card.className = 'day-card';
        card.setAttribute('data-key', dayLabel);

        let inner = '<div class="card-inner">';
        CSV_HEADERS.forEach(h => {
          if (h === 'Day') return;
          const val = item[h] || '';
          if (!val) return;

          // Apply sentence-to-newline formatting for normal text fields
          const isLinky = /video|slide/i.test(h);
          const body = isLinky ? escapeHtml(val) : sentencesToLines(val);

          inner += `
            <div class="section">
              <h3>${escapeHtml(h)}</h3>
              <div class="section-content">${body}</div>
            </div>`;
        });
        inner += '</div>';
        card.innerHTML = inner;
        main.appendChild(card);
      });
    }

    function openDay(key) {
      const cards = Array.from(document.querySelectorAll('.day-card'));
      const target = cards.find(c => c.getAttribute('data-key') === key);
      if (!target) {
        console.warn('No card found for day:', key);
        return false;
      }
      cards.forEach(c => c.classList.remove('visible'));
      target.classList.add('visible');

      const btns = Array.from(document.querySelectorAll('.day-btn'));
      btns.forEach(b => b.classList.remove('active'));
      const active = btns.find(b => b.dataset.key === key);
      if (active) active.classList.add('active');

      // Update URL hash to the exact CSV Day label
      const enc = encodeURIComponent(key);
      if (location.hash !== `#${enc}`) history.replaceState(null, '', `#${enc}`);

      // Scroll to top like a normal page load
      window.scrollTo({ top: 0, behavior: 'auto' });
      return true;
    }

    function applyInitialRoute() {
      const btns = Array.from(document.querySelectorAll('.day-btn'));
      if (!btns.length) return;
      const hash = decodeURIComponent(location.hash.replace(/^#/, ''));
      if (hash) {
        if (openDay(hash)) return;
      }
      // Fallback to first CSV day
      openDay(btns[0].dataset.key);
    }

    function escapeHtml(s) {
      return String(s)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    // Convert sentences to new lines, preserving URLs by running after escaping.
    function sentencesToLines(s) {
      const escaped = escapeHtml(s);
      // Replace one or more spaces after a period with a newline.
      // Avoid double-breaking if a newline already follows.
      return escaped
        .replace(/\. +/g, '.\n')
        .replace(/\.(?=$)/g, '.'); // keep trailing period as-is
    }
  </script>
</body>
</html>