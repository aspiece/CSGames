<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CompTIA A+ Accelerated Pacing Guide (16 Days)</title>
  <style>
    :root{--bg:#0f172a;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;--accent:#22d3ee;--table:#1f2937}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif}
    .wrap{max-width:1400px;margin:40px auto;padding:0 20px}
    h1{font-size:clamp(1.4rem,2.5vw,2rem);margin:0 0 10px}
    p{color:var(--muted);margin:0 0 24px}
    .card{background:var(--card);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.25);overflow:hidden;padding:18px}
    table{width:100%;border-collapse:collapse;font-size:14px}
    thead{background:var(--table)}
    th,td{padding:14px 12px;vertical-align:top}
    th{font-weight:700;text-align:left;letter-spacing:.02em}
    tbody tr{border-bottom:1px solid rgba(255,255,255,.06)}
    tbody tr:hover{background:rgba(34,211,238,.03)}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    .small{font-size:12px;color:var(--muted)}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:rgba(34,211,238,.15);color:#a5f3fc;font-weight:600;font-size:12px;margin-left:6px}
    .sticky{position:sticky;left:0;background:var(--card)}
    @media (max-width:900px){
      table{display:block;overflow:auto;white-space:nowrap}
    }
    ul.agenda{margin:6px 0;padding-left:18px;font-size:13px;line-height:1.4}

    /* Collapsible UI */
    .day-nav{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px;align-items:center}
    .day-btn{background:transparent;border:1px solid rgba(255,255,255,.06);color:var(--text);padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
    .day-btn.active{background:var(--accent);color:#042023;border:none}
    .day-row{display:none}
    .day-row.visible{display:table-row}
    td.day-toggle{cursor:pointer;width:48px;text-align:center;font-weight:700;border-right:1px solid rgba(255,255,255,.03)}
    .hint{color:var(--muted);font-size:13px;margin-bottom:8px}
    .status{color:var(--muted);margin-bottom:12px}
    .permalink {margin-left:12px;padding:6px 10px;border-radius:8px;background:rgba(255,255,255,.04);color:var(--muted);cursor:pointer;font-size:13px}
    .permalink.copied {background:var(--accent);color:#042023}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>CompTIA A+ Pacing Guide (16 Days)</h1>
    <p>Each day is a 1.5 hour session. Each agenda follows Merrill’s Effective Instruction (Activation → Demonstration → Application → Integration). All worksheets, videos, and assessments are distributed via Google Classroom. The substitute will use a slide deck (projected) to pace class time and display discussion prompts, timers, and brain-break instructions.</p>

    <div class="card">
      <div class="hint">This page loads its content exclusively from pacing.csv in the same directory. The slide deck and Classroom links referenced in the CSV are used by the substitute to run class. Click a day number to reveal that day's plan. Each day has a unique URL (hash).</div>
      <div id="status" class="status">Loading pacing.csv …</div>

      <div id="day-nav" class="day-nav" aria-hidden="false"></div>
      <button id="copy-permalink" class="permalink" title="Copy permalink for the currently open day" style="display:none">Copy link</button>

      <table id="pacing-table" role="table" aria-label="pacing guide">
        <thead>
          <tr>
            <th class="sticky">Day</th>
            <th>Lesson</th>
            <th>Topics</th>
            <th>Agenda (Merrill’s Principles)</th>
            <th>Brain Break (for sub to project)</th>
            <th>Summative</th>
            <th>Substitute Actions (During class)</th>
            <th>Teacher Prep (Before class)</th>
          </tr>
        </thead>
        <tbody id="pacing-body">
          <!-- Rows rendered from pacing.csv -->
        </tbody>
      </table>
    </div>

    <p class="small" style="margin-top:24px;">Guide by <b>aspiece</b>. For feedback or updates, contact the author.</p>
  </div>

  <script>
    // CSV utilities (handles quoted fields/newlines)
    function parseCSV(text) {
      const rows = [];
      let cur = '';
      let row = [];
      let inQuotes = false;
      for (let i = 0; i < text.length; i++) {
        const ch = text[i];
        const next = text[i+1];
        if (ch === '"') {
          if (inQuotes && next === '"') { cur += '"'; i++; } // escaped quote
          else inQuotes = !inQuotes;
          continue;
        }
        if (ch === ',' && !inQuotes) {
          row.push(cur); cur = ''; continue;
        }
        if ((ch === '\n' || ch === '\r') && !inQuotes) {
          if (ch === '\r' && next === '\n') { /* skip paired */ }
          if (cur !== '' || row.length) { row.push(cur); cur = ''; rows.push(row); row = []; }
          continue;
        }
        cur += ch;
      }
      if (cur !== '' || row.length) { row.push(cur); rows.push(row); }
      return rows;
    }

    function csvToObjects(text) {
      const rows = parseCSV(text).filter(r => r.length > 0);
      if (rows.length < 1) return [];
      const headers = rows[0].map(h => h.trim());
      return rows.slice(1).map(r => {
        const obj = {};
        headers.forEach((h, i) => obj[h] = (r[i] || '').trim());
        return obj;
      });
    }

    // render rows of arbitrary length
    function renderRows(data) {
      const tbody = document.getElementById('pacing-body');
      tbody.innerHTML = '';
      data.forEach(item => {
        const tr = document.createElement('tr');
        tr.className = 'day-row';
        tr.setAttribute('data-day', item.Day || '');
        tr.innerHTML = `
          <td class="sticky day-toggle">${escapeHtml(item.Day || '')}</td>
          <td>${escapeHtml(item.Lesson || '')}</td>
          <td>${escapeHtml(item.Topics || '')}</td>
          <td>${item.Agenda || ''}</td>
          <td>${item.BrainBreak || ''}</td>
          <td class="small">${escapeHtml(item.Summative || '—')}</td>
          <td>${item.SubActions || ''}</td>
          <td>${item.TeacherPrep || ''}</td>
        `;
        tbody.appendChild(tr);
      });
      initCollapsibleUI();
    }

    function escapeHtml(s) {
      return String(s)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    function fetchPacingCsv() {
      const statusEl = document.getElementById('status');
      return fetch('pacing.csv', {cache: 'no-store'})
        .then(resp => {
          if (!resp.ok) throw new Error('pacing.csv not found (HTTP ' + resp.status + ')');
          return resp.text();
        })
        .then(text => {
          const objs = csvToObjects(text);
          if (!objs.length) throw new Error('pacing.csv is empty or malformed');
          renderRows(objs);
          statusEl.textContent = `Loaded pacing.csv (${objs.length} day${objs.length===1?'':'s'})`;
          // If hash present or query param present, open that day
          setTimeout(() => applyInitialRoute(), 20);
        })
        .catch(err => {
          console.error(err);
          document.getElementById('status').textContent = 'Error loading pacing.csv — see console for details.';
          alert('Could not load pacing.csv from the same directory. Check that pacing.csv exists and uses header: Day,Lesson,Topics,Agenda,BrainBreak,Summative,SubActions,TeacherPrep');
        });
    }

    // open a day by value (Day cell content). If not found, try numeric index (1-based)
    function openDay(dayValue) {
      const rows = Array.from(document.querySelectorAll('.day-row'));
      if (!rows.length) return;
      // find row by data-day exact match
      let target = rows.find(r => r.getAttribute('data-day') === String(dayValue));
      if (!target) {
        // fallback: treat as 1-based index
        const idx = parseInt(dayValue, 10);
        if (!Number.isNaN(idx) && idx >= 1 && idx <= rows.length) target = rows[idx-1];
      }
      if (!target) return false;
      // hide all and show target
      rows.forEach(r => r.classList.remove('visible'));
      target.classList.add('visible');
      // update nav active state
      document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
      const btn = Array.from(document.querySelectorAll('.day-btn')).find(b => b.dataset.day === (target.getAttribute('data-day') || ''));
      if (btn) btn.classList.add('active');
      // set hash (unique URL)
      const hash = `day-${encodeURIComponent(target.getAttribute('data-day')||'')}`;
      if (location.hash !== `#${hash}`) location.hash = hash;
      // show permalink button
      document.getElementById('copy-permalink').style.display = 'inline-block';
      // scroll into view
      target.scrollIntoView({behavior: 'smooth', block: 'center'});
      return true;
    }

    // initialize nav/buttons and day-number toggles
    function initCollapsibleUI() {
      const rows = Array.from(document.querySelectorAll('.day-row'));
      const dayNav = document.getElementById('day-nav');
      dayNav.innerHTML = '';
      rows.forEach((row, idx) => {
        const day = row.getAttribute('data-day') || (idx+1).toString();
        const btn = document.createElement('button');
        btn.className = 'day-btn';
        btn.type = 'button';
        btn.textContent = day;
        btn.dataset.day = day;
        btn.addEventListener('click', () => openDay(day));
        dayNav.appendChild(btn);
      });

      // day-number clicks toggle too (in-table)
      document.querySelectorAll('td.day-toggle').forEach(td => {
        td.style.cursor = 'pointer';
        td.addEventListener('click', () => {
          const tr = td.closest('tr');
          const day = tr.getAttribute('data-day');
          openDay(day);
        });
      });
    }

    // Parse hash like #day-3 or #day-Intro and open matching day
    function parseHash() {
      if (!location.hash) return null;
      const h = location.hash.replace(/^#/, '');
      if (h.startsWith('day-')) return decodeURIComponent(h.slice(4));
      return null;
    }

    function applyInitialRoute() {
      const dayFromHash = parseHash();
      if (dayFromHash) {
        const opened = openDay(dayFromHash);
        if (!opened) {
          // if not matched, try numeric part (e.g., hash day-3 -> 3)
          const num = dayFromHash.match(/\d+/);
          if (num) openDay(num[0]);
        }
      }
    }

    // copy current URL (with hash) to clipboard
    function setupPermalink() {
      const btn = document.getElementById('copy-permalink');
      btn.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(location.href);
          btn.classList.add('copied');
          btn.textContent = 'Copied';
          setTimeout(() => { btn.classList.remove('copied'); btn.textContent = 'Copy link'; }, 1500);
        } catch (e) {
          alert('Could not copy link. Please copy manually: ' + location.href);
        }
      });

      // respond to hashchange (open day accordingly)
      window.addEventListener('hashchange', () => {
        const dayFromHash = parseHash();
        if (dayFromHash) openDay(dayFromHash);
      });
    }

    document.addEventListener('DOMContentLoaded', function() {
      setupPermalink();
      fetchPacingCsv();
    });
  </script>
</body>
</html>
