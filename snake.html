<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Snake</title>
  <style>
    :root { --bg:#23242a; --fg:#e8e8e8; --accent:#48d17a; --accent2:#2bb0ed; --danger:#ff6b6b; }
    *{box-sizing:border-box}
    body{margin:0; background:var(--bg); color:var(--fg); font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial}
    .wrap{display:grid; place-items:center; min-height:100vh; padding:16px}
    .game{display:grid; gap:12px; justify-items:center}
    canvas{background:#1a1c22; border:2px solid #2a2d36; border-radius:12px; width: min(92vw, 420px); height: min(92vw, 420px); image-rendering: pixelated}
    .hud{display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:center}
    .badge{padding:6px 10px; border-radius:10px; background:#1e222b; border:1px solid #2a2d36; min-width:80px; text-align:center}
    button, select, input[type="range"]{appearance:none; background:#1e222b; border:1px solid #2a2d36; color:var(--fg); padding:8px 12px; border-radius:10px; cursor:pointer}
    button:hover{border-color:#3a3f4d}
    .go{color:#fff; background: linear-gradient(135deg, var(--accent), var(--accent2)); border:none}
    .danger{background:var(--danger); border:none}
    .controls{display:flex; gap:8px; flex-wrap:wrap; justify-content:center}
    .kbd{padding:3px 6px; border-radius:6px; background:#242834; border:1px solid #2a2d36; font-size:12px}
    .mobile-pad{display:none; grid-template-columns:repeat(3,60px); grid-template-rows:repeat(3,60px); gap:8px; justify-content:center; align-items:center}
    .pad-btn{width:60px; height:60px; border-radius:14px; display:grid; place-items:center; font-weight:700}
    .pad-btn:active{filter:brightness(1.2)}
    @media (max-width:640px){ .mobile-pad{display:grid} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="game">
      <h1>Snake</h1>
      <canvas id="board" width="420" height="420" aria-label="Snake game board"></canvas>
      <div class="hud">
        <div class="badge">Score: <span id="score">0</span></div>
        <div class="badge">Best: <span id="best">0</span></div>
        <div class="badge">Speed: <span id="speedLabel">10</span></div>
      </div>
      <div class="controls">
        <button id="start" class="go">Start / Restart</button>
        <button id="pause">Pause</button>
        <label>Grid
          <select id="grid">
            <option value="20">20×20</option>
            <option value="24" selected>24×24</option>
            <option value="28">28×28</option>
            <option value="32">32×32</option>
          </select>
        </label>
        <label>Speed
          <input id="speed" type="range" min="5" max="20" value="10" />
        </label>
      </div>
      <div class="mobile-pad" aria-hidden="true">
        <span></span>
        <button class="pad-btn" data-dir="up">▲</button>
        <span></span>
        <button class="pad-btn" data-dir="left">◀</button>
        <button class="pad-btn" data-dir="down">▼</button>
        <button class="pad-btn" data-dir="right">▶</button>
        <span></span><span></span><span></span>
      </div>
      <p>Use <span class="kbd">↑</span><span class="kbd">↓</span><span class="kbd">←</span><span class="kbd">→</span> or <span class="kbd">WASD</span>. Don’t run into yourself. Eat apples to grow.</p>
    </div>
  </div>

  <script>
    (function(){
      const canvas = document.getElementById('board');
      const ctx = canvas.getContext('2d');
      const scoreEl = document.getElementById('score');
      const bestEl = document.getElementById('best');
      const startBtn = document.getElementById('start');
      const pauseBtn = document.getElementById('pause');
      const gridSel = document.getElementById('grid');
      const speedRange = document.getElementById('speed');
      const speedLabel = document.getElementById('speedLabel');

      let N = +gridSel.value;         // grid size (cells per side)
      let cell = Math.floor(canvas.width / N);
      let tickMsBase = 100;            // base timing for speed=10
      let speed = +speedRange.value;   // 5..20 (higher=faster)
      let playing = false;
      let raf = null;
      let lastTick = 0;
      let snake, dir, nextDir, food, score, best, grow;

      best = +localStorage.getItem('snake-best') || 0;
      bestEl.textContent = best;

      function reset(){
        N = +gridSel.value;
        cell = Math.floor(canvas.width / N);
        snake = [ {x:Math.floor(N/2), y:Math.floor(N/2)}, {x:Math.floor(N/2)-1, y:Math.floor(N/2)}, {x:Math.floor(N/2)-2, y:Math.floor(N/2)} ];
        dir = {x:1,y:0};
        nextDir = {x:1,y:0};
        food = randEmptyCell();
        score = 0; scoreEl.textContent = score;
        grow = 0;
        draw(true);
      }

      function randEmptyCell(){
        while(true){
          const p = {x: (Math.random()*N)|0, y: (Math.random()*N)|0};
          if(!snake || !snake.some(s=>s.x===p.x && s.y===p.y)) return p;
        }
      }

      function setSpeed(val){
        speed = +val; speedLabel.textContent = speed;
      }

      function gameOver(){
        playing = false;
        cancelAnimationFrame(raf);
        best = Math.max(best, score); bestEl.textContent = best; localStorage.setItem('snake-best', best);
        flash('Game Over');
      }

      function flash(text){
        ctx.save();
        ctx.fillStyle = 'rgba(0,0,0,0.45)';
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle = '#fff';
        ctx.font = '700 28px system-ui, -apple-system, Segoe UI, Roboto';
        ctx.textAlign = 'center';
        ctx.fillText(text, canvas.width/2, canvas.height/2);
        ctx.restore();
      }

      function step(ts){
        if(!playing){ draw(); return; }
        const perTick = tickMsBase * (10 / speed); // faster when speed>10
        if(ts - lastTick >= perTick){
          lastTick = ts;
          dir = nextDir;
          // compute next head
          const head = {x: (snake[0].x + dir.x + N) % N, y: (snake[0].y + dir.y + N) % N};
          // self collision
          if(snake.some((s,i)=> i>0 && s.x===head.x && s.y===head.y)){
            draw();
            return gameOver();
          }
          snake.unshift(head);
          if(head.x === food.x && head.y === food.y){
            score += 1; scoreEl.textContent = score; grow += 2; // grow by 2 per food
            food = randEmptyCell();
          }
          if(grow>0){ grow--; } else { snake.pop(); }
          draw();
        }
        raf = requestAnimationFrame(step);
      }

      function draw(clearOnly){
        // background grid
        ctx.fillStyle = '#1a1c22';
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.strokeStyle = '#20232b';
        ctx.lineWidth = 1;
        for(let i=1;i<N;i++){
          const p = i*cell; ctx.beginPath(); ctx.moveTo(p,0); ctx.lineTo(p,canvas.height); ctx.stroke();
          ctx.beginPath(); ctx.moveTo(0,p); ctx.lineTo(canvas.width,p); ctx.stroke();
        }
        if(clearOnly) return;
        // food
        drawCell(food.x, food.y, '#ff8e53');
        // snake
        for(let i=snake.length-1;i>=0;i--){
          const c = i===0?'#48d17a': '#35b86b';
          drawCell(snake[i].x, snake[i].y, c);
        }
      }

      function drawCell(x,y,color){
        const pad = Math.max(1, Math.floor(cell*0.1));
        ctx.fillStyle = color;
        ctx.fillRect(x*cell+pad, y*cell+pad, cell-2*pad, cell-2*pad);
      }

      function start(){ reset(); playing = true; lastTick = performance.now(); cancelAnimationFrame(raf); raf = requestAnimationFrame(step); }
      function pause(){ playing = !playing; if(playing){ lastTick = performance.now(); raf = requestAnimationFrame(step);} }

      // Input
      const keyDir = {
        ArrowUp:{x:0,y:-1}, ArrowDown:{x:0,y:1}, ArrowLeft:{x:-1,y:0}, ArrowRight:{x:1,y:0},
        w:{x:0,y:-1}, s:{x:0,y:1}, a:{x:-1,y:0}, d:{x:1,y:0}
      };

      function setDir(nd){
        // block 180° turns
        if((nd.x + dir.x === 0) && (nd.y + dir.y === 0)) return;
        nextDir = nd;
      }

      addEventListener('keydown', e=>{
        const nd = keyDir[e.key];
        if(nd){ e.preventDefault(); setDir(nd); }
        if(e.key===' '){ pause(); }
        if(e.key==='Enter'){ start(); }
      });

      document.querySelectorAll('.pad-btn').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const d = btn.dataset.dir;
          setDir({up:{x:0,y:-1}, down:{x:0,y:1}, left:{x:-1,y:0}, right:{x:1,y:0}}[d]);
        });
      });

      // UI controls
      startBtn.addEventListener('click', start);
      pauseBtn.addEventListener('click', pause);
      gridSel.addEventListener('change', ()=>{ reset(); draw(); });
      speedRange.addEventListener('input', e=> setSpeed(e.target.value));

      // initial draw
      reset(); draw();
    })();
  </script>
</body>
</html>
